<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>News Aggregator</title>
  <!-- Bootstrap CSS for basic styling -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    /* Basic styling for a clean and responsive layout */
    body {
      background-color: #f8f9fa;
      padding: 20px;
    }
    .card {
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    /* Ensure images fit nicely in the card */
    .card-img-top {
      max-height: 200px;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">Latest News</h1>
    <!-- This div will contain the news article cards -->
    <div id="articles"></div>
  </div>
  
  <!-- Tabletop.js for fetching Google Sheet data -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Your published Google Sheet key (ensure the sheet is published to the web)
      var publicSpreadsheetUrl = '1PYdzyMwUZYCadxjK7Q-w2j2C97Pl6FLkScffTjTYgik';
      
      // Initialize Tabletop.js to fetch data from your Google Sheet
      Tabletop.init({
        key: publicSpreadsheetUrl,
        callback: function(data, tabletop) {
          console.log("Fetched data:", data);
          if (!data || !Array.isArray(data)) {
            console.error("No data found or data is not an array.");
            return;
          }
          // Sort articles by Timestamp (newest first)
          data.sort(function(a, b) {
            return new Date(b.Timestamp) - new Date(a.Timestamp);
          });
          renderArticles(data);
        },
        simpleSheet: true
      });
    });

    // Function to render news articles as cards using your sheet's columns
    function renderArticles(articles) {
      var container = document.getElementById('articles');
      container.innerHTML = ''; // Clear existing content

      articles.forEach(function(article) {
        // Create a card container
        var card = document.createElement('div');
        card.className = 'card';

        // If ImageURL exists, add an image to the card
        if (article.ImageURL && article.ImageURL.trim() !== "") {
          var img = document.createElement('img');
          img.className = 'card-img-top';
          img.src = article.ImageURL;
          img.alt = article.Headline;
          card.appendChild(img);
        }

        // Create card body for text content
        var cardBody = document.createElement('div');
        cardBody.className = 'card-body';

        // Create the headline as a clickable title linking to the article URL
        var title = document.createElement('h5');
        title.className = 'card-title';
        var link = document.createElement('a');
        link.href = article.URL;
        link.target = '_blank';
        link.textContent = article.Headline;
        title.appendChild(link);
        cardBody.appendChild(title);

        // If a meme caption is provided, display it
        if (article["Meme Caption"] && article["Meme Caption"].trim() !== "") {
          var caption = document.createElement('p');
          caption.className = 'card-text';
          caption.textContent = article["Meme Caption"];
          cardBody.appendChild(caption);
        }

        // Display meta data: Timestamp and Source
        var meta = document.createElement('p');
        meta.className = 'card-text';
        meta.innerHTML = '<small class="text-muted">' + article.Timestamp + ' | ' + article.Source + '</small>';
        cardBody.appendChild(meta);

        // Append card body to card, then card to container
        card.appendChild(cardBody);
        container.appendChild(card);
      });
    }
  </script>
</body>
</html>
